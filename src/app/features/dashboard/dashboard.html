<!--<div class="dashboard-container">-->
<!--  @for (card of cards; track card) {-->
<!--    <div class="card"></div>-->
<!--  }-->
<!--</div>-->

<div class="dashboard-container">
  <div class="dashboard-cards-row">
    <div class="dashboard-card total-applications-card">
      <div class="card-content">
        <h3>Total Applications</h3>
        <p class="count">{{ totalApplicationsCount }}</p>
      </div>
      <mat-icon svgIcon="work"></mat-icon>
    </div>

    <div class="dashboard-card status-card">
      <div class="card-content">
        <h3>Interviews</h3>
        <p class="count">{{ interviewsCount }}</p>
      </div>
      <mat-icon>event</mat-icon>
    </div>

    <div class="dashboard-card status-card">
      <div class="card-content">
        <h3>Offers</h3>
        <p class="count">{{ offersCount }}</p>
      </div>
      <mat-icon>star</mat-icon>
    </div>

    <div class="dashboard-card status-card">
      <div class="card-content">
        <h3>Rejected</h3>
        <p class="count">{{ rejectedCount }}</p>
      </div>
      <mat-icon>cancel</mat-icon>
    </div>
  </div>

  <div class="dashboard-main-content-stacked">

    <div class="applications-overview-panel graph-panel">
      <h3>Application Trends</h3>

      <div class="graph-filters">
        <mat-form-field appearance="outline" class="date-range-picker">
          <mat-label>Start Date</mat-label>
          <input matInput [matDatepicker]="startDatePicker" [(ngModel)]="startDate" (dateChange)="onFilterChange()">
          <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #startDatePicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="date-range-picker">
          <mat-label>End Date</mat-label>
          <input matInput [matDatepicker]="endDatePicker" [(ngModel)]="endDate" (dateChange)="onFilterChange()">
          <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #endDatePicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" class="status-filter">
          <mat-label>Filter by Status</mat-label>
          <mat-select [(ngModel)]="selectedStatuses" multiple (selectionChange)="onFilterChange()">
            @for (status of allStatuses; track status) {
              <mat-option [value]="status">
                {{ status }}
              </mat-option>

            }
          </mat-select>
        </mat-form-field>


        <mat-radio-group [(ngModel)]="chartType" (change)="onFilterChange()" class="chart-type-selector">
          <mat-radio-button value="bar">Bar Chart</mat-radio-button>
          <mat-radio-button value="line">Line Chart</mat-radio-button>
        </mat-radio-group>


      </div>


      <div class="chart-container">
        @if (processedChartData.length === 0) {
          <div class="no-data-message">
            No data available for the selected filters.
          </div>

        }
        @if (chartType === 'bar' && processedChartData.length > 0) {
          <ngx-charts-bar-vertical
            [results]="processedChartData"
            [xAxis]="true"
            [yAxis]="true"
            [showXAxisLabel]="true"
            [showYAxisLabel]="true"
            xAxisLabel="Date"
            yAxisLabel="Number of Applications"
            [scheme]="'vivid'"
            [gradient]="true"
            [barPadding]="10"
            [roundDomains]="true"
            [showDataLabel]="true"
            [legend]="false"
            [tooltipDisabled]="false"
            (select)="onSelect($event)">
          </ngx-charts-bar-vertical>

        }


        @if (chartType === 'line' && processedChartData.length > 0) {
          <ngx-charts-line-chart
            [results]="lineChartData"
            [xAxis]="true"
            [yAxis]="true"
            [showXAxisLabel]="true"
            [showYAxisLabel]="true"
            xAxisLabel="Date"
            yAxisLabel="Number of Applications"
            [scheme]="'vivid'"
            [gradient]="true"
            [legend]="true"
            [showGridLines]="true"
            [roundDomains]="true"
            [tooltipDisabled]="false"
            (select)="onSelect($event)">
          </ngx-charts-line-chart>

        }
      </div>

      <h3 class="upcoming-events-header">Upcoming Events</h3>
      @if (upcomingEvents.length === 0) {
        <div class="no-data-message">
          No upcoming events.
        </div>

      }
      @if (upcomingEvents.length > 0) {
        <div class="event-list">
          @for (event of upcomingEvents; track event.id) {

            <div class="event-item">
              <div class="event-header">
                <strong>{{ event.company }} - {{ event.position }}</strong>
                <span class="event-date">{{ event.date | date:'shortDate' }}</span>
              </div>
              <p class="event-details">
                Type: <strong>{{ event.eventType }}</strong>
                @if (event.notes) {
                  <span> - {{ event.notes }}</span>
                }
              </p>
            </div>
          }
        </div>

      }
    </div>


    <div class="recent-activity-panel">
      <h3>Recent Activity</h3>
      @if (recentActivities.length === 0) {
        <div class="no-data-message">
          No recent activities yet.
        </div>

      }
      @if (recentActivities.length > 0) {
        <div class="activity-list">
          @for (activity of recentActivities; track activity) {
            <div class="activity-item">
              <div class="activity-header">
                <strong>{{ activity.company }} - {{ activity.position }}</strong>
                <span class="activity-date">{{ activity.date | date:'short' }}</span>
              </div>
              <p class="activity-details">
                Status changed from <strong>{{ activity.oldStatus }}</strong> to
                <strong>{{ activity.newStatus }}</strong>.
              </p>
              @if (activity.notes) {
                <p class="activity-notes">
                  Notes: {{ activity.notes }}
                </p>
              }
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>

<router-outlet/>
